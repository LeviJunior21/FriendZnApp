{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { Comentario } from \"../../model/Comentario\";\nimport { getUsuario } from \"../../utils/getUsuario\";\nexport var sendComentario = function sendComentario(props) {\n  var _props$webSock;\n  if (props.webSock.current != null && (_props$webSock = props.webSock) != null && _props$webSock.current.connected) {\n    var _props$webSock$curren;\n    var messageJSON = {\n      idPublicacao: props.publicacao.getId(),\n      comentario: props.message,\n      timestamp: new Date(),\n      codigoAcesso: 12345,\n      idUsuario: 1\n    };\n    var subscribe = \"/app/comentarios.sendMessage/\" + props.publicacao.getId();\n    (_props$webSock$curren = props.webSock.current) == null ? void 0 : _props$webSock$curren.send(subscribe, {}, JSON.stringify(messageJSON));\n    props.setMessage(\"\");\n    console.log(\"Enviado\");\n  } else {\n    console.error(\"Erro: WebSocket não conectado\");\n  }\n};\nexport var updateComentario = function () {\n  var _ref = _asyncToGenerator(function* (props) {\n    try {\n      var comentarioRecebido = JSON.parse(props.message.body);\n      var usuario = yield getUsuario(comentarioRecebido.usuarioId);\n      var novoComentario = Comentario.builder().withComentario(comentarioRecebido.comentario).withId(randint(1, 100)).withUsuario(usuario).build();\n      props.setComentarios(function (prevComentarios) {\n        return [].concat(_toConsumableArray(prevComentarios), [novoComentario]);\n      });\n    } catch (e) {}\n  });\n  return function updateComentario(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nfunction randint(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}","map":{"version":3,"names":["Comentario","getUsuario","sendComentario","props","_props$webSock","webSock","current","connected","_props$webSock$curren","messageJSON","idPublicacao","publicacao","getId","comentario","message","timestamp","Date","codigoAcesso","idUsuario","subscribe","send","JSON","stringify","setMessage","console","log","error","updateComentario","_ref","_asyncToGenerator","comentarioRecebido","parse","body","usuario","usuarioId","novoComentario","builder","withComentario","withId","randint","withUsuario","build","setComentarios","prevComentarios","concat","_toConsumableArray","e","_x","apply","arguments","min","max","Math","floor","random"],"sources":["/home/marcos_anderson/MeusProjetos/FriedZone/friendzoneapp/components/comentario/WSComentario.tsx"],"sourcesContent":["import { Client } from \"stompjs\";\nimport { Dispatch, SetStateAction, useRef } from \"react\";\nimport { Publicacao } from \"../../model/Publicacao\";\nimport { Usuario } from \"../../model/Usuario\";\nimport { Comentario } from \"../../model/Comentario\";\nimport { getUsuario } from \"../../utils/getUsuario\";\n\ninterface SendProps {\n    webSock: React.MutableRefObject<Client | null>, \n    publicacao: Publicacao, \n    message: string, \n    setMessage: Dispatch<SetStateAction<string>>\n}\nexport const sendComentario = (props: SendProps) => {\n    if (props.webSock.current != null && props.webSock?.current.connected) {\n        const messageJSON = {\n            idPublicacao: props.publicacao.getId(),\n            comentario: props.message,\n            timestamp: new Date(),\n            codigoAcesso: 12345,\n            idUsuario: 1\n        };\n        const subscribe: string = \"/app/comentarios.sendMessage/\" + props.publicacao.getId();\n        props.webSock.current?.send(subscribe, {}, JSON.stringify(messageJSON));\n        props.setMessage(\"\");\n        console.log(\"Enviado\");\n    } else {\n        console.error(\"Erro: WebSocket não conectado\");\n    }\n};\n\ninterface UpdateComentarioProps {\n    id: number;\n    message: any;\n    setComentarios: Dispatch<SetStateAction<Comentario[]>>;\n}\nexport const updateComentario = async(props: UpdateComentarioProps) => {\n    try {\n        const comentarioRecebido = JSON.parse(props.message.body);\n        const usuario = await getUsuario(comentarioRecebido.usuarioId);\n\n        const novoComentario = Comentario.builder()\n        .withComentario(comentarioRecebido.comentario)\n        .withId(randint(1,100))\n        .withUsuario(usuario)\n        .build();\n\n        props.setComentarios((prevComentarios) => [...prevComentarios, novoComentario]);\n        \n    } catch(e) {\n\n    }\n}\n\nfunction randint(min: number, max: number): number {\n    // Math.floor é usado para arredondar para baixo, garantindo um número inteiro.\n    return Math.floor(Math.random() * (max - min + 1) + min);\n}\n"],"mappings":";;AAIA,SAASA,UAAU;AACnB,SAASC,UAAU;AAQnB,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAcA,CAAIC,KAAgB,EAAK;EAAA,IAAAC,cAAA;EAChD,IAAID,KAAK,CAACE,OAAO,CAACC,OAAO,IAAI,IAAI,KAAAF,cAAA,GAAID,KAAK,CAACE,OAAO,aAAbD,cAAA,CAAeE,OAAO,CAACC,SAAS,EAAE;IAAA,IAAAC,qBAAA;IACnE,IAAMC,WAAW,GAAG;MAChBC,YAAY,EAAEP,KAAK,CAACQ,UAAU,CAACC,KAAK,CAAC,CAAC;MACtCC,UAAU,EAAEV,KAAK,CAACW,OAAO;MACzBC,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;MACrBC,YAAY,EAAE,KAAK;MACnBC,SAAS,EAAE;IACf,CAAC;IACD,IAAMC,SAAiB,GAAG,+BAA+B,GAAGhB,KAAK,CAACQ,UAAU,CAACC,KAAK,CAAC,CAAC;IACpF,CAAAJ,qBAAA,GAAAL,KAAK,CAACE,OAAO,CAACC,OAAO,qBAArBE,qBAAA,CAAuBY,IAAI,CAACD,SAAS,EAAE,CAAC,CAAC,EAAEE,IAAI,CAACC,SAAS,CAACb,WAAW,CAAC,CAAC;IACvEN,KAAK,CAACoB,UAAU,CAAC,EAAE,CAAC;IACpBC,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC;EAC1B,CAAC,MAAM;IACHD,OAAO,CAACE,KAAK,CAAC,+BAA+B,CAAC;EAClD;AACJ,CAAC;AAOD,OAAO,IAAMC,gBAAgB;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAM1B,KAA4B,EAAK;IACnE,IAAI;MACA,IAAM2B,kBAAkB,GAAGT,IAAI,CAACU,KAAK,CAAC5B,KAAK,CAACW,OAAO,CAACkB,IAAI,CAAC;MACzD,IAAMC,OAAO,SAAShC,UAAU,CAAC6B,kBAAkB,CAACI,SAAS,CAAC;MAE9D,IAAMC,cAAc,GAAGnC,UAAU,CAACoC,OAAO,CAAC,CAAC,CAC1CC,cAAc,CAACP,kBAAkB,CAACjB,UAAU,CAAC,CAC7CyB,MAAM,CAACC,OAAO,CAAC,CAAC,EAAC,GAAG,CAAC,CAAC,CACtBC,WAAW,CAACP,OAAO,CAAC,CACpBQ,KAAK,CAAC,CAAC;MAERtC,KAAK,CAACuC,cAAc,CAAC,UAACC,eAAe;QAAA,UAAAC,MAAA,CAAAC,kBAAA,CAASF,eAAe,IAAER,cAAc;MAAA,CAAC,CAAC;IAEnF,CAAC,CAAC,OAAMW,CAAC,EAAE,CAEX;EACJ,CAAC;EAAA,gBAhBYnB,gBAAgBA,CAAAoB,EAAA;IAAA,OAAAnB,IAAA,CAAAoB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAgB5B;AAED,SAASV,OAAOA,CAACW,GAAW,EAAEC,GAAW,EAAU;EAE/C,OAAOC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,IAAIH,GAAG,GAAGD,GAAG,GAAG,CAAC,CAAC,GAAGA,GAAG,CAAC;AAC5D"},"metadata":{},"sourceType":"module","externalDependencies":[]}